#!/usr/bin/env bash
set -euo pipefail

if [[ -z "$PROJECTS_ROOT" ]]; then
  echo "Env var PROJECTS_ROOT undefined" 1>&2
  exit 1
fi

story=$1
pr=${2:-}
branch=$story

if [[ ! -z "$pr" ]]; then
  branch="pr/$pr"
fi

worktree_dir="$PROJECTS_ROOT/stories/$(basename $PWD)/$story"

git worktree add $worktree_dir -b $branch
echo $worktree_dir

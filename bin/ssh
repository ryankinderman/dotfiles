#!/bin/bash
# Indicate to the remote shell environment that the client is launched from within X

script_path=${BASH_SOURCE[0]}
ssh_commands=($(which -a ssh))

if [[ "$SSH_LAST_INDEX" != "" ]]; then
  last_index=$SSH_LAST_INDEX
else
  last_index=0
fi

for (( i=$last_index; i < ${#ssh_commands[@]}; i=$i+1 )); do
  # handle possibility of a relative path being in PATH
  ssh_command="${ssh_commands[$i]}"
  if [[ "${ssh_command:0:2}" == "./" ]]; then
    ssh_command="$PWD/${ssh_command:2}"
  fi

  if [[ "$ssh_command" == $script_path ]]; then
    break
  fi
done

if [[ $((i+1)) -eq ${#ssh_commands[@]} ]]; then
  echo "Could not find an ssh command other than this one (${BASH_SOURCE[0]}); exiting" 1>&2
  exit 1
fi

real_ssh=${ssh_commands[$((i+1))]}

unset SSH_LAST_INDEX
export LC_IN_X=$(if [ -n "${DISPLAY+x}" ]; then echo "true"; else echo "false"; fi)
exec $real_ssh -o SendEnv=LC_IN_X $*
